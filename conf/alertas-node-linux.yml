# Autor: Robson Vaamonde
# Site: www.procedimentosemti.com.br
# Facebook: facebook.com/ProcedimentosEmTI
# Facebook: facebook.com/BoraParaPratica
# YouTube: youtube.com/BoraParaPratica
# Linkedin: https://www.linkedin.com/in/robson-vaamonde-0b029028/
# Instagram: https://www.instagram.com/procedimentoem/?hl=pt-br
# Data de criação: 04/02/2022
# Data de atualização: 10/01/2026
# Versão: 0.07
# Testado e homologado para a versão do Ubuntu Server 22.04.x LTS x64x
# Testado e homologado para a versão do Prometheus 3.9.x e Node Exporter 1.10.x
#
# ======= BLOCO DE ALERTAS BÁSICO DO NODE EXPORTER LINUX ======= 
#
# Configuração dos grupos de alertas do Node Exporter
groups:
- name: alertas-node-linux
  rules:
  #
  # Configuração do alerta de: Uso elevado de CPU
  - alert: CPUAlta
    expr: 100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Uso elevado de CPU"
      description: "CPU acima de 80% por mais de 5 minutos no host {{ $labels.instance }}."
  #
  # Configuração do alerta de: Uso elevado de Memória RAM
  - alert: MemoriaAlta
    expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Uso elevado de Memória"
      description: "Memória RAM acima de 85% no host {{ $labels.instance }}."
  #
  # Configuração do alerta de: Uso elevado de Hard Disk Cheio
  - alert: DiscoCheio
    expr: (1 - (node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} / node_filesystem_size_bytes{fstype!~"tmpfs|overlay"})) * 100 > 90
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Disco quase cheio"
      description: "Uso de disco acima de 90% no host {{ $labels.instance }} ({{ $labels.mountpoint }})."
  #
  # Configuração do alerta de: Uso elevado de Processamento
  - alert: Processamento
    expr: node_load15 > count by (instance) (node_cpu_seconds_total{mode="system"})
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Load Average elevado"
      description: "Load 15 maior que o número de CPUs no host {{ $labels.instance }}."
