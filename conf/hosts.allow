# Autor: Robson Vaamonde<br>
# Procedimentos em TI: http://procedimentosemti.com.br<br>
# Bora para Prática: http://boraparapratica.com.br<br>
# Robson Vaamonde: http://vaamonde.com.br<br>
# Facebook Procedimentos em TI: https://www.facebook.com/ProcedimentosEmTi<br>
# Facebook Bora para Prática: https://www.facebook.com/BoraParaPratica<br>
# Instagram Procedimentos em TI: https://www.instagram.com/procedimentoem<br>
# YouTUBE Bora Para Prática: https://www.youtube.com/boraparapratica<br>
# Data de criação: 01/01/2026<br>
# Data de atualização: 08/01/2026<br>
# Versão: 0.02<br>
# Testado e homologado para a versão do Ubuntu Server 22.04.x LTS x64
#
# Comando utilizado para verificar se o serviço (daemon) de rede tem suporte ao 
# TCPWrappers: ldd /usr/sbin/sshd | grep libwrap (Biblioteca LibWrap), o OpenSSH
# tem suporte nativo a biblioteca do TCPWrappers, garantindo a sua segurança sem
# utilizar regras de Firewall (iptables ou ufw).
#
# Logando todas as informações de acesso nos arquivos de Log's de cada serviço
# em: /var/log/allow-*.log (* nome do serviço).
#
# Opções de configuração do Hosts Allow: Daemon (serviço de rede), Client (cliente
# que vai acessar o serviço), Shell Command (comando que será executado depois que
# acessar o serviço)
#
# Opções das variáveis do Hosts Allow: date -u (--universal), %d (The daemon process name),
# %R (The servers port number), %A (The server host address), %N (The server host name),
# %c (Client information), %r (The clients port number), %p (The daemon process id)
#
#=================== BLOCO DE CONFIGURAÇÃO DA LIBERAÇÃO DOS DAEMON ===================
#
# Permitindo a Rede 172.16.1.0/24 se autenticar remotamente no Servidor de OpenSSH
# DAEMON     CLIENT     SHELL COMMAND
sshd: 172.16.1.0/24: spawn /bin/echo "$(date -u) | Serviço Local %d | Porta Local %R | Host Local %A | Hostname %N | Host Remoto %c | Porta Remota %r | Processo Local %p" >> /var/log/allow-ssh.log
#
# Permitindo a Rede 172.16.1.0/24 obter os dados remotamente no Servidor de SNMPd
# DAEMON     CLIENT     SHELL COMMAND
#snmpd: 172.16.1.0/24: spawn /bin/echo "$(date -u) | Serviço Local %d | Porta Local %R | Host Local %A | Hostname %N | Host Remoto %c | Porta Remota %r | Processo Local %p" >> /var/log/allow-ssh.log
#
# =================== Exemplos de configuração do TCPWrappers do arquivo hosts.allow: ===================
#
# Permitindo uma Subrede ou nome de domínio FQDN
# DAEMON     CLIENT     SHELL COMMAND
#sshd: 172.16.1. : spawn /bin/echo "$(date) Conexão Liberada - SSH - IP %a" >> /var/log/allow-ssh.log
#sshd: 172.16.1.0/255.255.255.0: spawn /bin/echo "$(date) Conexão Liberada - SSH - IP %a" >> /var/log/allow-ssh.log
#sshd: 172.16.1.0/24: spawn /bin/echo "$(date) Conexão Liberada - SSH - IP %a" >> /var/log/allow-ssh.log
#sshd: *.pti.intra: spawn /bin/echo "$(date) Conexão Liberada - SSH - IP %a" >> /var/log/allow-ssh.log
#sshd: 172.16.1. EXCEPT 172.16.1.11: spawn /bin/echo "$(date) Conexão Liberada - SSH - IP %a" >> /var/log/allow-ssh.log
