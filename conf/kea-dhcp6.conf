// Autor: Robson Vaamonde
// Site: www.procedimentosemti.com.br
// Facebook: facebook.com/ProcedimentosEmTI
// Facebook: facebook.com/BoraParaPratica
// YouTube: youtube.com/BoraParaPratica
// Linkedin: https://www.linkedin.com/in/robson-vaamonde-0b029028/
// Instagram: https://www.instagram.com/procedimentoem/?hl=pt-br
// Data de criação: 24/11/2025
// Data de atualização: 24/11/2025
// Versão: 0.01
// Testado e homologado para a versão do Ubuntu Server 22.04.x LTS x64x
// Testado e homologado para a versão do Kea DHCP6 Server v3.0.x
//
// ====== BLOCO DE CONFIGURAÇÃO PADRÃO DO KEA DHCP6 SERVER ======

{
"Dhcp6": {

    // ---------------------------------------------------------
    // Interfaces de Rede nas quais o Kea vai responder DHCPv6
    // ---------------------------------------------------------
    "interfaces-config": {
        "interfaces": [ "enp0s3" ]
    },

    // ---------------------------------------------------------
    // Control Socket (permite administração via API/kea-shell)
    // ---------------------------------------------------------
    "control-socket": {
        "socket-type": "unix",
        "socket-name": "/var/run/kea/kea6-ctrl-socket"
    },

    // A partir do Kea 2.7.4, a biblioteca de hooks libdhcp_pgsql.so deve ser carregada para
    // armazenar reservas de host no backend de banco de dados PostgreSQL.
    // Especifique o local da biblioteca de hooks do backend de host.
    "hooks-libraries": [
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_pgsql.so"
      },
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_stat_cmds.so"
      },
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_host_cmds.so"
      },
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_lease_cmds.so"
      },
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_subnet_cmds.so"
      }
    ],

    // ---------------------------------------------------------
    // Banco de Leases (memfile = arquivo local, ideal para testes)
    // Banco de Leases (postgresql = banco de dados, ideal para grandes redes)
    // lfc-interval = intervalo do cleaner de leases expirados
    // ---------------------------------------------------------
    "lease-database": {
        "lfc-interval": 3600,
        // Bloco de configuração do Banco de Dados Memfile (Desativado)
        //"type": "memfile",
        //"persist": true,
        //"name": "dhcp4.leases",
        // Bloco de configuração do Banco de Dados PostgreSQL
        "type": "postgresql",
        "name": "keaserver",
        "user": "keaserver",
        "password": "keaserver",
        "host": "127.0.0.1",
        "port": 5432
    },

    // ---------------------------------------------------------
    // Processamento de leases expirados
    // ---------------------------------------------------------
    "expired-leases-processing": {
        "reclaim-timer-wait-time": 10,
        "flush-reclaimed-timer-wait-time": 25,
        "hold-reclaimed-time": 3600,
        "max-reclaim-leases": 100,
        "max-reclaim-time": 250,
        "unwarned-reclaim-cycles": 5
    },

    // ---------------------------------------------------------
    // Timers DHCP (S1, S2 e validade total)
    // ---------------------------------------------------------
    "renew-timer": 900,            // T1 → Renewal
    "rebind-timer": 1800,          // T2 → Rebinding
    "valid-lifetime": 3600,        // Tempo total do lease
    "preferred-lifetime": 3000,    // Preferência do tempo de lease

    // ---------------------------------------------------------
    // Opções globais para toda a rede
    // ---------------------------------------------------------
    "option-data": [
        {
            "name": "dns-servers",
            "data": "2804:14c:90:8697::20"
        },

        {
            "name": "new-posix-timezone",
            "data": "EST5EDT4\\,M3.2.0/02:00\\,M11.1.0/02:00"
        },

        {
            "name": "preference",
            "data": "0xf0"
        },

        {
            "name": "bootfile-param",
            "data": "root=/dev/sda2, quiet, splash"
        }
    ],

    // ---------------------------------------------------------
    // Subnets configuradas do DHCP6
    // ---------------------------------------------------------
    "subnet6": [
        {
            // Identificação da Sub-rede 
            "id": 1,
            "subnet": "2804:14c:90:8697::/64",

            // Faixa de IPs dinâmicos (Range)
            "pools": [ 
                { "pool": "2804:14c:90:8697::100 - 2804:14c:90:8697::ffff" } 
            ],
        }
      ],

    // ---------------------------------------------------------
    // Logging do serviço DHCP4
    // ---------------------------------------------------------
    "loggers": [
        {
            "name": "kea-dhcp6",
            "output-options": [
                {
                    "output": "/var/log/kea/kea-dhcp6.log",
                    "pattern": "%-5p %m\n"
                }
            ],
            "severity": "INFO",
            "debuglevel": 0
        }
    ]
  }
}
