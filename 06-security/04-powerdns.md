#Autor: Robson Vaamonde<br>
#Procedimentos em TI: http://procedimentosemti.com.br<br>
#Bora para Pr√°tica: http://boraparapratica.com.br<br>
#Robson Vaamonde: http://vaamonde.com.br<br>
#Facebook Procedimentos em TI: https://www.facebook.com/ProcedimentosEmTi<br>
#Facebook Bora para Pr√°tica: https://www.facebook.com/BoraParaPratica<br>
#Instagram Procedimentos em TI: https://www.instagram.com/procedimentoem<br>
#YouTUBE Bora Para Pr√°tica: https://www.youtube.com/boraparapratica<br>
#Data de cria√ß√£o: 07/10/2025<br>
#Data de atualiza√ß√£o: 23/11/2025<br>
#Vers√£o: 0.09<br>

**OBSERVA√á√ÉO IMPORTANTE:** COMENTAR NO V√çDEO DO POWERDNS SE VOC√ä CONSEGUIU FAZER O DESAFIO COM A SEGUINTE FRASE: *Desafio do PowerDNS realizado com sucesso!!! #BoraParaPr√°tica*

COMPARTILHAR O SELO DO DESAFIO NAS SUAS REDES SOCIAIS (LINKEDIN, FACEBOOK, INSTAGRAM) MARCANDO: ROBSON VAAMONDE COM AS HASHTAGS E COPIANDO O CONTE√öDO DO DESAFIO ABAIXO: 

LINK DO SELO: https://github.com/vaamonde/ubuntu-2204/blob/main/selos/23-powerdns.png

#boraparapratica #boraparapr√°tica #vaamonde #robsonvaamonde #procedimentosemti #ubuntuserver #ubuntuserver2204 #desafiovaamonde #desafioboraparapratica #desafiopowerdns #desafiopowerdnsadmin #deafiopowerdnsrecursor

Conte√∫do estudado nesse desafio:<br>
#01_ Adicionando o Reposit√≥rio do Node.JS e do NPM (Node Packet Manager) no Ubuntu Server<br>
#02_ Instalando a Vers√£o LTS do Node.JS e do NPM (Node Packet Manager) no Ubuntu Server<br>
#03_ Instalando as depend√™ncias do PowerDNS Authoritative, Recursor e do Admin no Ubuntu Server<br>
#04_ Desativando o Servi√ßo do Systemd e Resolu√ß√£o de DNS do Resolved do Ubuntu Server<br>
#05_ Baixando e instalando a Chave GPG do PowerDNS Authoritative e Recursor no Ubuntu Server<br>
#06_ Criando o reposit√≥rio do PowerDNS Authoritative e Recursor no Ubuntu Server<br>
#07_ Atualizando as Lista do Apt com o novo Reposit√≥rio do PowerDNS no Ubuntu Server<br>
#08_ Instalando o PowerDNS Authoritative, Recursor e Backend PostgreSQL no Ubuntu Server<br>
#09_ Verificando os servi√ßos do PowerDNS Authoritative e Recursor no Ubuntu Server<br>
#10_ Localiza√ß√£o dos diret√≥rios principais do PowerDNS Authoritative e Recursor no Ubuntu Server<br>
#11_ Adicionado o Usu√°rio Local no Grupo Padr√£o do PowerDNS no Ubuntu Server<br>
#12_ Criando a Base de Dados do PowerDNS Authoritative no PostgreSQL Server no Ubuntu Server<br>
#13_ Testando o acesso a Base de Dados do PowerDNS Authoritative no PostgreSQL Server no Ubuntu Server<br>
#14_ Populando as Tabelas no Banco de Dados do PowerDNS Authoritative utilizando o arquivo de esquema do PostgreSQL Server no Ubuntu Server<br>
#15_ Atualizando os arquivos de configura√ß√£o do PowerDNS Authoritative e Recursor no Ubuntu Server<br>
#16_ Editando os arquivos de configura√ß√£o dos servi√ßos do PowerDNS no Ubuntu Server<br>
#17_ Testando o servi√ßo do PowerDNS Authoritative e Backend PostgreSQL no Ubuntu Server<br>
#18_ Verificando a Porta de Conex√£o do PowerDNS Authoritative e Recursor no Ubuntu Server<br>
#19_ Criando uma Zona de Pesquisa Direta Interna no PowerDNS Authoritative no Ubuntu Server<br>
#20_ Criando uma Zona de Pesquisa Reversa Interna no PowerDNS Authoritative no Ubuntu Server<br>
#21_ Testando as resolu√ß√µes de Zonas e Nomes DNS no PowerDNS Authoritative no Ubuntu Server<br>
#22_ Fazendo o download do PowerDNS Admin e descompactando no diret√≥rio padr√£o do NGINX Server no Ubuntu Server<br>
#23_ Atualizando os arquivos de configura√ß√£o do PowerDNS Admin no Ubuntu Server<br>
#24_ Editando os arquivos de configura√ß√£o do PowerDNS Admin no Ubuntu Server<br>
#25_ Configurando o Ambiente Virtual e instalando as Depend√™ncias do PowerDNS Admin no Ubuntu Server<br>
#26_ Alterando as permiss√µes dos diret√≥rios do PowerDNS Admin no Ubuntu Server<br>
#27_ Desativando o site padr√£o do NGINX Server no Ubuntu Server<br>
#28_ Habilitando e iniciando os servi√ßos do PowerDNS Admin no Ubuntu Server<br>
#29_ Acessando e configurando o PowerDNS Authoritative via navegador no PowerDNS Admin<br>
#30_ Desafio do PowerDNS Authoritative e Recursor<br>

Site Oficial do PowerDNS: https://www.powerdns.com/<br>
Site Oficial do PowerDNS Authoritative: https://www.powerdns.com/powerdns-authoritative-server<br>
Site Oficial do PowerDNS Recursor: https://www.powerdns.com/powerdns-recursor<br>
Site Oficial do PowerDNS Admin: https://www.poweradmin.org/

**Sites de IA (Intelig√™ncia Artificial) indicados para os Desafios**<br>
OpenAI ChatGPT: https://chatgpt.com<br>
Microsoft Copilot: https://copilot.microsoft.com<br>
Google Gemini: https://gemini.google.com<br>
DeepSeek: https://chat.deepseek.com/<br>
x.AI Grok: https://grok.com/<br>

**O QUE √â E PARA QUE SERVER O DNS:** O DNS (Domain Name System) √© o sistema que traduz nomes de dom√≠nio em endere√ßos IP, funcionando como uma ‚Äúagenda telef√¥nica da Internet‚Äù. Quando voc√™ digita www.google.com, o DNS √© quem descobre o endere√ßo IP real do servidor onde o site est√° hospedado, permitindo que seu computador se conecte a ele.

**O QUE √â E PARA QUE SERVER O POWERDNS:** O PowerDNS √© uma alternativa avan√ßada ao BIND9 (da ISC.org), desenvolvido para oferecer melhor desempenho, escalabilidade e integra√ß√£o com bancos de dados. Ele √© open source, multiplataforma e amplamente utilizado em provedores de Internet, data centers e grandes empresas.

**O QUE √â E PARA QUE SERVER O POWERDNS AUTHORITATIVE:** O PowerDNS Authoritative Server √© um servidor DNS autoritativo moderno, leve e altamente flex√≠vel, respons√°vel por responder oficialmente pelas zonas de dom√≠nio que ele gerencia. Ou seja, ele n√£o faz recurs√£o, apenas responde com autoridade pelas informa√ß√µes DNS que est√£o sob sua responsabilidade.

**O QUE √â E PARA QUE SERVER O POWERDNS RECURSOR:** O PowerDNS Recursor √© um servidor DNS recursivo ‚Äî ou seja, ele n√£o √© autoritativo, mas √© quem faz o trabalho de buscar respostas para consultas DNS, tanto internas quanto externas. Ele atua como o intermedi√°rio inteligente entre o cliente (por exemplo, seu navegador ou servidor local) e os servidores DNS autoritativos espalhados pela internet.

**O QUE √â E PARA QUE SERVER O POWERDNS ADMIN:** O PowerDNS-Admin √© uma interface web moderna e intuitiva desenvolvida para gerenciar servidores PowerDNS de forma simples, visual e organizada. Ele √© o ‚Äúpainel de controle‚Äù do PowerDNS ‚Äî ideal para quem n√£o quer (ou n√£o precisa) editar arquivos de zona manualmente no terminal.

[![PowerDNS](http://img.youtube.com/vi//0.jpg)]( "PowerDNS")

Link da v√≠deo aula: 

**OBSERVA√á√ÉO IMPORTANTE:** O POWERDNS SERVER E POWERDNS ADMIN POSSUI A DEPEND√äNCIA DO *BANCO DE DADOS POSTGRESQL*, ESSE APLICATIVO J√Å FOI INSTALADO NA ETAPA: **10 DO POSTGRESQL SERVER 18**.

**OBSERVA√á√ÉO IMPORTANTE:** √â RECOMENDADO UTILIZADO O NGINX SERVER PARA AS CONFIGURA√á√ïES DO POWERDNS ADMIN, CUIDADO COM A INSTALA√á√ÉO DO APACHE2 SERVER PARA N√ÉO ENTRAR EM CONFLITO NAS CONFIGURA√á√ïES, RECOMENDADO INSTALAR O NGINX SERVER DE FORMA SIMPLES, SEM CONFIGURA√á√ÉO EXTRA DO PHP-FPM. 

## 01_ Adicionando o Reposit√≥rio do Node.JS e do NPM (Node Packet Manager) no Ubuntu Server
```bash
#Script de configura√ß√£o do Reposit√≥rio do Node.JS (VERS√ÉO EST√ÅVEL AT√â O MOMENTO: 22.x EM: 11/11/2025)
#op√ß√£o do comando curl: -f (fail), -s (silent), -S (show-error), -L (location)
#op√ß√£o do redirecionador |: Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do comando sudo: -E (preserve-env)
sudo curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash
```

## 02_ Instalando a Vers√£o LTS do Node.JS e do NPM (Node Packet Manager) no Ubuntu Server
```bash
#atualizando as listas do Apt com o novo reposit√≥rio do Node.JS
#op√ß√£o do comando apt: update (Resynchronize the package index files from their sources
sudo apt update

#Instalando o Node.JS e NPM (Node Package Manager)
#op√ß√£o do comando apt: install (install is followed by one or more package names)
sudo apt install nodejs
```

## 03_ Instalando as depend√™ncias do PowerDNS Authoritative, Recursor e do Admin no Ubuntu Server
```bash
#instalando as depend√™ncias do PowerDNS Authoritative, Recursor Admin no Ubuntu Server
#op√ß√£o do comando apt: install (install is followed by one or more package names)
#op√ß√£o da contra barra (\): criar uma quebra de linha no terminal
sudo apt install nginx python3-dev libsasl2-dev libldap2-dev libssl-dev libxml2-dev libxslt1-dev \
libxmlsec1-dev libffi-dev pkg-config apt-transport-https virtualenv build-essential curl ssl-cert \
git python3-flask libpq-dev vim gnupg gcc g++ make software-properties-common tree ca-certificates \
php-pgsql libmariadb-dev

#instalando a depend√™ncia do PowerDNS Admin do Yarn
#op√ß√£o do comando npm: install (install a package), -g (in global mode)
sudo npm install -g yarn
```

## 04_ Desativando o Servi√ßo do Systemd e Resolu√ß√£o de DNS do Resolved do Ubuntu Server
```bash
#parando o servi√ßo do Systemd Resolved do Ubuntu Server
#op√ß√£o do comando systemctl: stop (Stop (deactivate) one or more units specified on the command line)
sudo systemctl stop systemd-resolved

#desabilitando o servi√ßo do Systemd Resolved do Ubuntu Server
#op√ß√µes do comando systemctl: disable (Disables one or more units), --now (When used with disable, 
#the units will also be disabled service)
sudo systemctl disable --now systemd-resolved

#removendo o arquivo resolv.conf do Ubuntu Server
#op√ß√£o do comando rm: -r (recursive), -f (force), -v (verbose)
sudo rm -rfv /etc/resolv.conf

#atualizando o arquivo resolv.conf com servidores DNS Tempor√°rios do Google
#op√ß√£o do comando echo: -e (enable interpretation of backslash escapes)
#op√ß√£o do redirecionador |: Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do caracter especial de escape \n: number line
#op√ß√£o do redirecionador de sa√≠da > (maior): Redireciona a sa√≠da padr√£o (STDOUT)
echo -e "nameserver 8.8.8.8 \nnameserver 2001:4860:4860::8888" | sudo tee /etc/resolv.conf > /dev/null

#listando o conte√∫do do arquivo resolv.conf com servidor DNS Tempor√°rio do Google
#op√ß√£o do comando cat: -n (number line)
sudo cat -n /etc/resolv.conf

#testando a resolu√ß√£o de nomes tempor√°rios do DNS no Ubuntu Server
sudo nslookup google.com
```

## 05_ Baixando e instalando a Chave GPG do PowerDNS Authoritative e Recursor no Ubuntu Server

**OBSERVA√á√ÉO IMPORTANTE:** o PowerDNS Authoritative e Recursor possui v√°rias vers√µes, para verificar as *chaves GPG* de cada vers√£o acesse o link: https://repo.powerdns.com/

```bash
#download da Chave GPG do PowerDNS Authoritative (VERS√ÉO EST√ÅVEL AT√â O MOMENTO: 5.0.x EM: 20/11/2025)
#op√ß√£o do comando curl: -f (fail), -s (silent), -S (show-error), -L (location)
#op√ß√£o do redirecionador | (piper): Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do comando gpg: -o (output)
curl -fsSL https://repo.powerdns.com/FD380FBB-pub.asc | sudo gpg --dearmor -o /usr/share/keyrings/powerdns-auth-5.0.gpg

#download da Chave GPG do PowerDNS Recursor (VERS√ÉO EST√ÅVEL AT√â O MOMENTO: 5.3.x EM: 11/11/2025)
#op√ß√£o do comando curl: -f (fail), -s (silent), -S (show-error), -L (location)
#op√ß√£o do redirecionador | (piper): Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do comando gpg: -o (output)
curl -fsSL https://repo.powerdns.com/FD380FBB-pub.asc | sudo gpg --dearmor -o /usr/share/keyrings/powerdns-recur-5.3.gpg
```

## 06_ Criando o reposit√≥rio do PowerDNS Authoritative e Recursor no Ubuntu Server
```bash
#criando o arquivo do reposit√≥rio do Apt do PowerDNS Authoritative no Ubuntu Server
#op√ß√£o do redirecionador |: Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do redirecionador de sa√≠da > (maior): Redireciona a sa√≠da padr√£o (STDOUT)
echo "deb [signed-by=/usr/share/keyrings/powerdns-auth-5.0.gpg] http://repo.powerdns.com/ubuntu jammy-auth-50 main" | sudo tee /etc/apt/sources.list.d/pdns-auth.list > /dev/null

#criando o arquivo do reposit√≥rio do Apt do PowerDNS Recursor no Ubuntu Server
#op√ß√£o do redirecionador |: Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do redirecionador de sa√≠da > (maior): Redireciona a sa√≠da padr√£o (STDOUT)
echo "deb [signed-by=/usr/share/keyrings/powerdns-recur-5.3.gpg] http://repo.powerdns.com/ubuntu jammy-rec-53 main" | sudo tee /etc/apt/sources.list.d/pdns-recur.list > /dev/null

#criando o arquivo de prefer√™ncias do PowerDNS no Ubuntu Server
#op√ß√£o do comando echo: -e (enable interpretation of backslash escapes)
#op√ß√£o do redirecionador |: Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do caracter especial de escape \n: number line
#op√ß√£o do redirecionador de sa√≠da > (maior): Redireciona a sa√≠da padr√£o (STDOUT)
echo -e "Package: pdns-* \nPin: origin repo.powerdns.com \nPin-Priority: 600" | sudo tee /etc/apt/preferences.d/powerdns > /dev/null
```

## 07_ Atualizando as Lista do Apt com o novo Reposit√≥rio do PowerDNS no Ubuntu Server
```bash
#atualizando as listas do Apt com o novo reposit√≥rio no Ubuntu Server
#op√ß√£o do comando apt: update (Resynchronize the package index files from their sources)
sudo apt update
```

## 08_ Instalando o PowerDNS Authoritative, Recursor e Backend PostgreSQL no Ubuntu Server
```bash
#instando o PowerDNS Authoritative, Recursor e Backend PostgreSQL no Ubuntu Server
#op√ß√£o do comando apt: install (install is followed by one or more package names)
sudo apt install pdns-server pdns-recursor pdns-backend-pgsql pdns-tools ipv6calc
```

## 09_ Verificando os servi√ßos do PowerDNS Authoritative e Recursor no Ubuntu Server

**OBSERVA√á√ÉO IMPORTANTE:** POR PADR√ÉO O POWERDNS AUTHORITATIVE E O RECURSOR EST√ÉO CONFIGURADOS NA MESMA PORTA (53/UDP) CAUSANDO A FALHA DE INICIALIZA√á√ÉO DO SERVI√áO DO POWERDNS AUTHORITATIVE SERVER, ESSA FALHA SER√Å CORRIGIDA NAS CONFIGURA√á√ïES DO SERVIDOR.

```bash
#verificando os servi√ßos do PowerDNS Authoritative e Recursor
#op√ß√µes do comando systemctl: status (runtime status information), restart (Stop and then 
#start one or more units), stop (Stop (deactivate) one or more units), start (Start (activate) 
#one or more units)
sudo systemctl status pdns pdns-recursor
sudo systemctl restart pdns pdns-recursor
sudo systemctl reload pdns pdns-recursor
sudo systemctl stop pdns pdns-recursor
sudo systemctl start pdns pdns-recursor

#analisando os Log's e mensagens de erros do PowerDNS Authoritative e Recursor
#op√ß√£o do comando journalctl: x (catalog), e (pager-end), u (unit)
sudo journalctl -xeu pdns
sudo journalctl -xeu pdns-recursor
```

**OBSERVA√á√ÉO IMPORTANTE:** Por que sempre √© necess√°rio verificar a vers√£o do servi√ßo de rede que voc√™ est√° implementando ou configurando no Servidor Ubuntu Server, devido as famosas falhas de seguran√ßa chamadas de: *CVE (Common Vulnerabilities and Exposures)*, com base na vers√£o utilizada podemos pesquisar no site do **Ubuntu Security CVE Reports:** https://ubuntu.com/security/cves as falhas de seguran√ßa encontradas e corrigidas da vers√£o do nosso aplicativo, o que ela afeta, se foi corrigida e como aplicar a corre√ß√£o.

```bash
#verificando as vers√µes do PowerDNS Authoritative e Recursor
#op√ß√£o do comandos pdns_server e pdns_recursor: --version (version)
sudo pdns_server --version     #consultando a vers√£o do PowerDNS Authoritative
sudo pdns_recursor --version   #consultando a vers√£o do PowerDNS Recursor
```

## 10_ Localiza√ß√£o dos diret√≥rios principais do PowerDNS Authoritative e Recursor no Ubuntu Server
```bash
/etc/powerdns/*                        <-- Diret√≥rio dos arquivos de configura√ß√£o do servi√ßo do PowerDNS
/etc/powerdns/pdns.conf                <-- Arquivo de configura√ß√£o principal do servi√ßo do PowerDNS Authoritative
/etc/powerdns/recursor.conf            <-- Arquivo de configura√ß√£o principal do servi√ßo do PowerDNS Recursor
/etc/powerdns/pdns.d/                  <-- Diret√≥rio dos arquivos de configura√ß√£o do PowerDNS Authoritative
/etc/powerdns/pdns.d/bind.conf         <-- Arquivo de configura√ß√£o da Base de Dados Backend do Bind9 DNS Server
/etc/powerdns/pdns.d/pdns-pgsql.conf   <-- Arquivo de configura√ß√£o da Base de Dados Backend do PostgreSQL Server
/etc/powerdns/recursor.d/              <-- Diret√≥rio dos arquivos de configura√ß√£o do PowerDNS Recursor
/var/lib/powerdns/                     <-- Diret√≥rio dos arquivos de Zonas de Dom√≠nio do PowerDNS Authoritative
/var/log/syslog e auth                 <-- Arquivos de Logs do PowerDNS Authoritative e Recursor
```

## 11_ Adicionado o Usu√°rio Local no Grupo Padr√£o do PowerDNS Authoritative e Recursor no Ubuntu Server
```bash
#op√ß√µes do comando usermod: -a (append), -G (groups), $USER (environment variable)
#OBSERVA√á√ÉO IMPORTANTE: voc√™ pode substituir a vari√°vel de ambiente $USER pelo
#nome do usu√°rio existente no sistema para adicionar no Grupo desejado.
sudo usermod -a -G pdns $USER

#verificando as informa√ß√µes do grupo PDNS do PowerDNS Authoritative e Recursor
#op√ß√£o do comando getent: group (the database system group)
sudo getent group pdns
```

## 12_ Criando a Base de Dados do PowerDNS Authoritative no PostgreSQL Server no Ubuntu Server

**OBSERVA√á√ÉO IMPORTANTE:** NESSE CEN√ÅRIO O BANCO DE DADOS DO POSTGRESQL SERVER UTILIZADO PELO POWERDNS AUTHORITATIVE EST√Å NO MESMO SERVIDOR PARA EFEITO DE DESEMPENHO E SEGURAN√áA, N√ÉO √â RECOMENDO HABILITAR O RECURSO DE CONEX√ÉO REMOTA DO POSTGRESQL SERVER E NEM CRIAR USU√ÅRIOS REMOTOS.

```bash
#conectando no PostgreSQL Server utilizando o cliente psql
#op√ß√£o do comando sudo: -u (user), psql (terminal PostgreSQL)
sudo -u postgres psql
```
```sql
/* Criando o Banco de Dados do PowerDNS Authoritative com o nome: powerdns */
/* OBSERVA√á√ÉO IMPORTANTE: ALTERAR O NOME DA BASE DE DADOS CONFORME NECESSIDADE */
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/sql-createdatabase.html */
CREATE DATABASE powerdns;

/* Listando o Banco de Dados criado do PowerDNS Authoritative no PostgreSQL Server */
/* op√ß√£o do comando \l: (list databases) */
/* mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/app-psql.html */
\l powerdns
```

**OBSERVA√á√ÉO IMPORTANTE:** ALTERAR O NOME DO USU√ÅRIO E SENHA CONFORME SUA NECESSIDADE, NESSE CEN√ÅRIO EST√Å SENDO CRIADO UM USU√ÅRIO LOCAL.

```sql
/* Criando o usu√°rio e senha da Base de Dados do PowerDNS Authoritative */
/* OBSERVA√á√ÉO IMPORTANTE: ALTERAR O NOME DO USU√ÅRIO E SENHA CONFORME NECESSIDADE */
/* mais informa√ß√µes acesse: https://www.postgresql.org/docs/8.0/sql-createuser.html */
CREATE USER powerdns WITH PASSWORD 'SUA_SENHA_SEGURA';

/* Listando o Usu√°rio do PowerDNS Authoritative criado no PostgreSQL Server */
/* op√ß√£o do comando \du: (Lists database roles) */
/* mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/app-psql.html */
\du powerdns

/* Alterando o dono da Base de Dados do PowerDNS Authoritative no PostgreSQL Server */
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/sql-alterdatabase.html */
ALTER DATABASE powerdns OWNER TO powerdns;

/* Alterando as permiss√µes da Base de Dados do PowerDNS Authoritative no PostgreSQL Server */
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/sql-grant.html */
GRANT ALL PRIVILEGES ON DATABASE powerdns TO powerdns;

/* Alterando os privil√©gios do Esquema P√∫blico da Base de Dados do PowerDNS Authoritative no PostgreSQL Server */
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/sql-grant.html */
GRANT ALL PRIVILEGES ON SCHEMA public TO powerdns;

/* Conectando no Base de Dados do PowerDNS Authoritative no PostgreSQL Server */
/* op√ß√£o do comando \connect: (establish a database connection) */
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/ecpg-sql-connect.html */
\connect powerdns;

/* Saindo do Banco de Dados PostgreSQL Server */
/* op√ß√£o do comando \q: (quit) */
/* mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/app-psql.html */
\q
```

## 13_ Testando o acesso a Base de Dados do PowerDNS Authoritative no PostgreSQL Server no Ubuntu Server
```bash
#conectando no banco de dados PostgreSQL Server com o usu√°rio powerdns
#op√ß√µes do comando psql: --username (database user name), --password (password user), --host (database server host), 
#--dbname (database name to connect to)
sudo psql --username powerdns --password --host localhost --dbname powerdns
```
```sql
/* verificando as informa√ß√µes do Banco de Dados do PowerDNS Authoritative no PostgreSQL Server */
/* op√ß√£o do comando \conninfo: (Outputs information about the current database connection) */
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/9.1/app-psql.html*/
\conninfo

/* Saindo do Banco de Dados PostgreSQL Server */
/* op√ß√£o do comando \q: (quit) */
/* mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/app-psql.html */
\q
```

## 14_ Populando o Banco de Dados do PowerDNS Authoritative utilizando o arquivo de esquema do PostgreSQL Server no Ubuntu Server
```bash
#importando o esquema e os dados iniciais do banco de dados do PowerDNS Authoritative
#op√ß√µes do comando psql: --username (database user name), --password (password user), --host (database server host), 
#--dbname (database name to connect to), --echo-all (view output script), --file (file script execution)
sudo psql --username powerdns --password --host localhost --dbname powerdns --echo-all --file /usr/share/pdns-backend-pgsql/schema/schema.pgsql.sql

#conectando no banco de dados PostgreSQL Server com o usu√°rio powerdns
#op√ß√µes do comando psql: --username (database user name), --password (password user), --host (database server host), 
#--dbname (database name to connect to)
sudo psql --username powerdns --password --host localhost --dbname powerdns
```
```sql
/* Verificando as informa√ß√µes das Tabelas do PowerDNS Authoritative no PostgreSQL Server */
/* op√ß√£o do comando \dt: (For each relation (table, view, index, sequence, or foreign table))
/* Mais informa√ß√µes acesse: https://www.postgresql.org/docs/9.1/app-psql.html*/
\dt

/* Saindo do Banco de Dados PostgreSQL Server */
/* op√ß√£o do comando \q: (quit) */
/* mais informa√ß√µes acesse: https://www.postgresql.org/docs/current/app-psql.html */
\q
```

## 15_ Atualizando os arquivos de configura√ß√£o do PowerDNS Authoritative, Recursor e Backend no Ubuntu Server
```bash
#fazendo o backup do arquivo de configura√ß√£o do PowerDNS Authoritative Backend Bind9 DNS Server
#op√ß√£o do comando cp: -v (verbose)
sudo cp -v /etc/powerdns/pdns.d/bind.conf /etc/powerdns/pdns.d/bind.conf.old

#fazendo o backup do arquivo de configura√ß√£o do PowerDNS Authoritative
#op√ß√£o do comando cp: -v (verbose)
sudo cp -v /etc/powerdns/pdns.conf /etc/powerdns/pdns.conf.old

#fazendo o backup do arquivo de configura√ß√£o do PowerDNS Recursor
#op√ß√£o do comando cp: -v (verbose)
sudo cp -v /etc/powerdns/recursor.conf /etc/powerdns/recursor.conf.old

#atualizando o arquivo de configura√ß√£o do PowerDNS Authoritative Backend Bind9 DNS Server do Github
#OBSERVA√á√ÉO IMPORTANTE: NESSE ARQUIVO EST√Å SENDO DESATIVADO O RECURSO DE BANCO DE DADOS
#UTILIZANDO O SERVI√áO DO BIND9 DNS SERVER COMO SERVI√áO DE BACKEND DO POWERDNS AUTHORITATIVE
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/powerdns/pdns.d/bind.conf https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/pdns-bind.conf

#atualizando o arquivo de configura√ß√£o do PowerDNS Authoritative do Backend PostgreSQL Server do Github
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/powerdns/pdns.d/pdns-pgsql.conf https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/pdns-pgsql.conf

#atualizando o arquivo de configura√ß√£o do PowerDNS Authoritative do Github
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/powerdns/pdns.conf https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/pdns.conf

#atualizando o arquivo de configura√ß√£o do PowerDNS Recursor do Github
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/powerdns/recursor.conf https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/recursor.conf
```

## 16_ Editando os arquivos de configura√ß√£o dos servi√ßos do PowerDNS no Ubuntu Server

**OBSERVA√á√ÉO IMPORTANTE:** O ARQUIVO DE CONFIGURA√á√ÉO DO BACKEND BIND9 SERVER EST√Å COM TODAS AS LINHAS COMENTADAS PARA N√ÉO ENTRAR EM CONFLITO COM O BACKEND DO POSTGRESQL SERVER.

```bash
#editar o arquivo de configura√ß√£o do PowerDNS Backend PostgreSQL Server
sudo vim /etc/powerdns/pdns.d/pdns-pgsql.conf

#entrando no modo de edi√ß√£o do editor de texto VIM
INSERT
```
```bash
#alterar as linhas de: 20 at√© 32 das vari√°veis de conex√£o do PostgreSQL Server
gpgsql-host=127.0.0.1
gpgsql-port=5432
gpgsql-dbname=powerdns
gpgsql-user=powerdns
gpgsql-password=powerdns
```
```bash
#salvar e sair do arquivo
ESC SHIFT :x <Enter>

#editar o arquivo de configura√ß√£o do PowerDNS Authoritative
sudo vim /etc/powerdns/pdns.conf

#entrando no modo de edi√ß√£o do editor de texto VIM
INSERT
```
```bash
#alterar as linhas de: 34 at√© 38 das vari√°veis
local-address=127.0.0.1
local-port=5300
server-id=auth.pti.intra
```
```bash
#salvar e sair do arquivo
ESC SHIFT :x <Enter>

#editar o arquivo de configura√ß√£o do PowerDNS Recursor
sudo vim /etc/powerdns/recursor.conf

#entrando no modo de edi√ß√£o do editor de texto VIM
INSERT
```
```bash
#alterar as linhas de: 17 at√© 65 das vari√°veis dos endere√ßos IPv4 e IPv4
#Zonas Internas de encaminhamento e encaminhadores externos de DNS Server
```
```bash
#salvar e sair do arquivo
ESC SHIFT :x <Enter>

#atualizando o arquivo resolv.conf com servidor do PowerDNS Recursor
#op√ß√£o do comando echo: -e (enable interpretation of backslash escapes)
#op√ß√£o do redirecionador |: Conecta a sa√≠da padr√£o com a entrada padr√£o de outro comando
#op√ß√£o do caracter especial de escape \n: number line
#op√ß√£o do redirecionador de sa√≠da > (maior): Redireciona a sa√≠da padr√£o (STDOUT)
echo -e "nameserver 172.16.1.20 \nnameserver 2804:14c:90:8697::20" | sudo tee /etc/resolv.conf > /dev/null

#listando o conte√∫do do arquivo resolv.conf com servidor DNS Tempor√°rio do Google
#op√ß√£o do comando cat: -n (number line)
sudo cat -n /etc/resolv.conf
```

## 17_ Testando o servi√ßo do PowerDNS Authoritative e Backend PostgreSQL no Ubuntu Server
```bash
#parando o servi√ßo do PowerDNS Authoritative no Ubuntu Server
#op√ß√£o do comando systemctl: stop (Stop (deactivate) one or more units)
sudo systemctl stop pdns

#testando o arquivo de configura√ß√£o do PowerDNS Authoritative
#op√ß√£o do comando pdns_server: --config (Show the current configuration)
#mais informa√ß√µes acesse: https://doc.powerdns.com/authoritative/manpages/pdns_server.1.html
sudo pdns_server --config

#testando o arquivo de configura√ß√£o do PowerDNS Authoritative
#op√ß√£o do comando pdns_recursor: --config (Show the current configuration)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-recursor/pdns_recursor.1.en.html
sudo pdns_recurso --config

#testando o servi√ßo do PowerDNS Authoritative se est√° conectando com o Backend PostgreSQL Server
#op√ß√£o do comando pdns_server: --daemon (Indicate  if  the  server should run in the background 
#as a real daemon, or in the foreground), --guardian (Run pdns_server inside a guardian. This 
#guardian  monitors  the performance  of  the inner pdns_server instance), --loglevel (Set the 
#logging level)
#OBSERVA√á√ÉO: para finalizar o teste do servi√ßo do PowerDNS Authoritative pressione: Ctrl+C
#mais informa√ß√µes acesse: https://doc.powerdns.com/authoritative/manpages/pdns_server.1.html
sudo pdns_server --daemon=no --guardian=no --loglevel=9

#reiniciando os servi√ßos do PowerDNS Authoritative e Recursor
#op√ß√µes do comando systemctl: restart (Stop and then start one or more units), status 
#(runtime status information)
sudo systemctl restart pdns pdns-recursor
sudo systemctl status pdns pdns-recursor

#analisando os Log's e mensagens de erros do PowerDNS Authoritative e Recursor
#op√ß√£o do comando journalctl: x (catalog), e (pager-end), u (unit)
sudo journalctl -xeu pdns
sudo journalctl -xeu pdns-recursor

#testando as m√©tricas do PowerDNS Authoritative utilizando o Web Server Interno
curl http://127.0.0.1:8081/metrics
```

## 18_ Verificando a Porta de Conex√£o do PowerDNS Authoritative e Recursor no Ubuntu Server

| Protocolo | Porta | O que √© utilizado? | Quando √© utilizado? | PowerDNS Authoritative | PowerDNS Recursor |
|----------|-------|--------------------|----------------------|------------------------|--------------------|
| **UDP**  | 53    | Consultas r√°pidas e leves | Resolu√ß√µes comuns de DNS; respostas pequenas (geralmente at√© 512 bytes, EDNS pode ampliar) | Responde a consultas comuns dos clientes e recursivos | Envia e recebe consultas r√°pidas; prefere UDP para desempenho |
| **TCP**  | 53    | Conex√µes confi√°veis e com controle | Respostas grandes (DNSSEC, muitos registros), transfer√™ncia de zona (AXFR/IXFR), fallback quando o UDP falha | Necess√°rio para transfer√™ncias de zona e respostas grandes; usado como fallback | Usado para respostas grandes ou quando UDP √© bloqueado/insuficiente; fallback |

**OBSERVA√á√ÉO IMPORTANTE:** no Ubuntu Server as Regras de Firewall utilizando o comando: __` iptables `__ ou: __` ufw `__ est√° desabilitado por padr√£o **(INACTIVE)**, caso voc√™ tenha habilitado algum recurso de Firewall √© necess√°rio fazer a libera√ß√£o do *Fluxo de Entrada (INPUT), Porta (PORT) e Protocolo (PROTOCOL) TCP* do Servi√ßo corresponde nas tabelas do firewall e testar a conex√£o.

```bash
#verificando as portas padr√µes TCP-53, 5300 e 8081 e UDP-53 e 5300 do PowerDNS Authoritative e Recursor
#op√ß√£o do comando lsof: -n (network number), -P (port number), -i (list IP Address), -s (alone directs)
sudo lsof -nP -iTCP:'53,5300,8081' -sTCP:LISTEN
sudo lsof -nP -iUDP:'53,5300'
```

## 19_ Criando uma Zona de Pesquisa Direta Interna no PowerDNS Authoritative no Ubuntu Server

# üìò Conceito B√°sico sobre os Registro do PowerDNS Authoritative

| Termo | O que √© | Para que serve / Fun√ß√£o |
|------|---------|--------------------------|
| **Zona de Pesquisa Direta (Forward Zone)** | Zona/arquivo DNS que resolve *nomes ‚Üí endere√ßos IP*. | Permite consultar um nome (ex.: `www.exemplo.com`) e obter o IP correspondente. |
| **DNSSEC** | Extens√£o de seguran√ßa para DNS. | Garante autenticidade e integridade das respostas usando assinaturas digitais; evita ataques como DNS Spoofing. |
| **Registro SOA (Start of Authority)** | Primeiro registro da zona DNS. | Define o servidor autoritativo principal e par√¢metros da zona (serial, refresh, retry, expire). |
| **Registro NS (Name Server)** | Registro que especifica os servidores DNS da zona. | Informa quais servidores s√£o respons√°veis por responder pelas consultas daquela zona. |
| **Registro A** | Mapeia um nome para um endere√ßo IPv4. | Usado para resolver **nome ‚Üí IPv4**, como `www ‚Üí 192.168.1.10`. |
| **Registro CNAME** | Registro de alias (apelido) para outro nome. | Permite que um nome seja um apelido de outro nome, facilitando gerenciamento (`loja ‚Üí www`). |

```bash
#criando a Zona de Pesquisa Direta Interna no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: create-zone (Create an empty zone named ZONE), pti.intra (Zone named), 
#ns1.pti.intra (Create register record NS1 with Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil create-zone pti.intra ns1.pti.intra

#listando todas as Zonas Internas do PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: list-all-zones (List all zones named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil list-all-zones

#listando apenas a Zona Direta Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone list (List same zone named) pti.intra (Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone list pti.intra

#verificando erros na Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: check-zone (Check zone ZONE for correctness)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil check-zone pti.intra

#habilitando o suporte ao DNSSEC na Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: secure-zone (Configures a zone called ZONE with reasonable DNSSEC settings)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil secure-zone pti.intra

#visualizando detalhes da Zona Direta Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone show (Shows various details of the zone called ZONE)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone show pti.intra

#removendo o registro do tipo SOA (start of authority) da Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: delete-rrset (Delete named RRSET from zone. NAME must be absolute), pti.intra (Zone named),
#pti.intra (record name), SOA (Type of register - start of authority)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil delete-rrset pti.intra pti.intra SOA

#criando o registro do tipo SOA (start of authority) da Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), pti.intra (zone name), pti.intra (record name), SOA (Type SOA - Start os Authority), 3600 (TTL - Time to Live),
#ns1.pti.intra (NS - primary DNS server), hostmaster.pti.intra. (responsible mail), 2025100801 (number of serial zone),
# 3600 (TTL - time to live zone), 600 (retry zone), 604800 (expire zone), 86400 (minimum negative TTIL)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record pti.intra pti.intra SOA 3600 "ns1.pti.intra. hostmaster.pti.intra. 2025100801 3600 600 604800 86400"

#criando o registro do tipo A (IPv4 Address) e AAAA (IPv6 Address) da Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), pti.intra (zone name), ns1. pti.intra (record name NS - name server), A (type IPv4 record), AAAA (type IPv6
#record) 3600 (TTL - Time to Live), 172.16.1.20 - 2804:14c:90:8697::20 (IPv4 and IPv6 Address record name)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record pti.intra ns1.pti.intra A 3600 172.16.1.20
sudo pdnsutil add-record pti.intra ns1.pti.intra AAAA 3600 2804:14c:90:8697::20

#criando o registro do tipo A (IPv4 Address) e AAAA (IPv6 Address) da Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), pti.intra (zone name), pti.intra (record name), A (type IPv4 record), AAAA (type IPv6 record) 3600 (TTL-Time
#to Live), 172.16.1.20 - 2804:14c:90:8697::20 (IPv4 and IPV6 Address record name)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record pti.intra pti.intra A 3600 172.16.1.20
sudo pdnsutil add-record pti.intra pti.intra AAAA 3600 2804:14c:90:8697::20

#criando o registro do tipo A (IPv4 Address) e AAAA (IPv6 Address) da Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), pti.intra (zone name), wsvaamonde.pti.intra (record name), A (type IPv4 record), AAAA (type IPv6 record), 
# 3600 (TTL - Time to Live), 172.16.1.20 - 2804:14c:90:8697::20 (IPv4 and IPv6 Address record name)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record pti.intra wsvaamonde.pti.intra A 3600 172.16.1.20
sudo pdnsutil add-record pti.intra wsvaamonde.pti.intra AAAA 3600 2804:14c:90:8697::20

#criando o registro do tipo CNAME (Canonical Name) da Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), pti.intra (zone name), wsvaamonde.pti.intra (record name), A (type IPv4 record), 3600 (TTL - Time to Live),
# 172.16.1.20 (IPv4 Address record name)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record pti.intra pdns.pti.intra CNAME 3600 "wsvaamonde.pti.intra"

#atualizando os registros das Zonas Internas criadas no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: rectify-all-zone
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil rectify-all-zones

#recarregar todas as Zonas Internas do PowerDNS Authoritative sem reiniciar o servi√ßo
#op√ß√£o do comando pdns_control: reload (Instruct the server to reload all its zones, this will not add new zones)
#mais informa√ß√µes acesse: https://doc.powerdns.com/authoritative/manpages/pdns_control.1.html
sudo pdns_control reload

#listando todas as Zonas Internas do PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: list-all-zones (List all zones named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil list-all-zones

#listando apenas a Zona Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone list (List same zone named) pti.intra (Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone list pti.intra
```

## 20_ Criando uma Zona de Pesquisa Reversa IPv4 in-addr.arpa Interna no PowerDNS Authoritative no Ubuntu Server

# üìò Conceito B√°sico sobre os Registro do PowerDNS Authoritative

| **Termo** | **O que √©** | **Para que serve / Fun√ß√£o** |
| --------- | ----------- | --------------------------- |
| **Zona de Pesquisa Reversa (Reverse Zone)** | Parte do DNS respons√°vel por mapear **endere√ßos IP para nomes de host**. Utiliza `in-addr.arpa` (IPv4) e `ip6.arpa` (IPv6). | Permite a **resolu√ß√£o reversa**, essencial para logs, auditorias, autentica√ß√µes, e v√°rios servi√ßos como e-mail, DHCP, Kerberos e valida√ß√µes de seguran√ßa. |
| **DNSSEC**  | Extens√£o de seguran√ßa que adiciona **assinaturas digitais** aos registros DNS. | Garante **autenticidade, integridade e verifica√ß√£o criptogr√°fica** da zona. Protege contra envenenamento de cache e respostas forjadas.|
| **Registro SOA (Start of Authority)** | Primeiro registro obrigat√≥rio da zona. Define o servidor principal, e-mail respons√°vel, serial e informa√ß√µes de atualiza√ß√£o. | Identifica a **autoridade** da zona reversa e controla a sincroniza√ß√£o entre servidores DNS.|
| **Registro NS (Name Server)** | Registros que apontam para os servidores DNS autoritativos da zona. | Define **quais servidores** respondem oficialmente pela zona reversa. Sem NS, n√£o h√° autoridade DNS. |
| **Registro PTR (Pointer Record)** | Registro que faz o mapeamento de **IP ‚Üí nome DNS** (oposto do A/AAAA). | Permite identificar o nome de um host a partir do IP. Essencial para logs, e-mail (rDNS), auditoria, integra√ß√£o com DHCP e servi√ßos internos. |


```bash
#criando a Zona de Pesquisa Reversa IPv4 in-addr.arpa Interna no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: create-zone (Create an empty zone named ZONE), *.in-addr.arpa (Zone named), 
#ns1.pti.intra (Create register record NS1 with Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil create-zone 1.16.172.in-addr.arpa ns1.pti.intra

#listando todas as Zonas Internas do PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: list-all-zones (List all zones named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil list-all-zones

#listando apenas a Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone list (List same zone named), *.in-addr.arpa (Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone list 1.16.172.in-addr.arpa

#verificando erros na Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: check-zone (Check zone ZONE for correctness)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil check-zone 1.16.172.in-addr.arpa

#habilitando o suporte ao DNSSEC na Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: secure-zone (Configures a zone called ZONE with reasonable DNSSEC settings)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil secure-zone 1.16.172.in-addr.arpa

#visualizando detalhes da Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone show (Shows various details of the zone called ZONE)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone show 1.16.172.in-addr.arpa

#removendo o registro do tipo SOA (start of authority) da Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: delete-rrset (Delete named RRSET from zone. NAME must be absolute), *.in-addr.arpa (Zone named),
#*.in-addr.arpa (record name), SOA (Type of register - start of authority)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil delete-rrset 1.16.172.in-addr.arpa 1.16.172.in-addr.arpa SOA

#criando o registro do tipo SOA (start of authority) da Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), *.in-addr.arpa (zone name), *.in-addr.arpa (record name), SOA (Type SOA - Start os Authority), 3600 (TTL - Time to Live),
#ns1.pti.intra (NS - primary DNS server), hostmaster.pti.intra. (responsible mail), 2025100801 (number of serial zone),
# 3600 (TTL - time to live zone), 600 (retry zone), 604800 (expire zone), 86400 (minimum negative TTIL)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record 1.16.172.in-addr.arpa 1.16.172.in-addr.arpa SOA 3600 "ns1.pti.intra. hostmaster.pti.intra. 2025100801 3600 600 604800 86400"

#criando o registro do tipo PTR (IPv4 Address) da Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), *.in-addr.arpa (zone name), 20.1.16.172.in-addr.arpa (register IPv4), PTR (point register), 3600 (TTL Time to Live)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record 1.16.172.in-addr.arpa 20.1.16.172.in-addr.arpa PTR 3600 pti.intra
sudo pdnsutil add-record 1.16.172.in-addr.arpa 20.1.16.172.in-addr.arpa PTR 3600 ns1.pti.intra
sudo pdnsutil add-record 1.16.172.in-addr.arpa 20.1.16.172.in-addr.arpa PTR 3600 wsvaamonde.pti.intra

#atualizando os registros das Zonas Internas criadas no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: rectify-all-zone
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil rectify-all-zones

#recarregar todas as Zonas Internas do PowerDNS Authoritative sem reiniciar o servi√ßo
#op√ß√£o do comando pdns_control: reload (Instruct the server to reload all its zones, this will not add new zones)
#mais informa√ß√µes acesse: https://doc.powerdns.com/authoritative/manpages/pdns_control.1.html
sudo pdns_control reload

#listando todas as Zonas Internas do PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: list-all-zones (List all zones named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil list-all-zones

#listando apenas a Zona Reversa IPv4 in-addr.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone list (List same zone named) *.in-addr.arpa (Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone list 1.16.172.in-addr.arpa
```

## 20_ Criando uma Zona de Pesquisa Reversa IPv6 ip6.arpa Interna no PowerDNS Authoritative no Ubuntu Server

# üìò Conceito B√°sico sobre os Registro do PowerDNS Authoritative

| **Termo** | **O que √©** | **Para que serve / Fun√ß√£o** |
| --------- | ----------- | --------------------------- |
| **Zona de Pesquisa Reversa (Reverse Zone)** | Parte do DNS respons√°vel por mapear **endere√ßos IP para nomes de host**. Utiliza `in-addr.arpa` (IPv4) e `ip6.arpa` (IPv6). | Permite a **resolu√ß√£o reversa**, essencial para logs, auditorias, autentica√ß√µes, e v√°rios servi√ßos como e-mail, DHCP, Kerberos e valida√ß√µes de seguran√ßa. |
| **DNSSEC** | Extens√£o de seguran√ßa que adiciona **assinaturas digitais** aos registros DNS. | Garante **autenticidade, integridade e verifica√ß√£o criptogr√°fica** da zona. Protege contra envenenamento de cache e respostas forjadas.|
| **Registro SOA (Start of Authority)** | Primeiro registro obrigat√≥rio da zona. Define o servidor principal, e-mail respons√°vel, serial e informa√ß√µes de atualiza√ß√£o. | Identifica a **autoridade** da zona reversa e controla a sincroniza√ß√£o entre servidores DNS.|
| **Registro NS (Name Server)** | Registros que apontam para os servidores DNS autoritativos da zona. | Define **quais servidores** respondem oficialmente pela zona reversa. Sem NS, n√£o h√° autoridade DNS. |
| **Registro PTR (Pointer Record)** | Registro que faz o mapeamento de **IP ‚Üí nome DNS** (oposto do A/AAAA). | Permite identificar o nome de um host a partir do IP. Essencial para logs, e-mail (rDNS), auditoria, integra√ß√£o com DHCP e servi√ßos internos. |

| **Termo** | **O que √©** | **Para que serve / Fun√ß√£o** |
|-----------|-------------|-----------------------------|
| **IPv6 Address** | Endere√ßo de 128 bits dividido em 8 blocos de 16 bits (hextetos). | Identificar unicamente um host na rede IPv6. √â a base para convers√£o em nibbles para DNS reverso. |
| **Hexteto** | Bloco de 16 bits representado por 4 d√≠gitos hexadecimais (ex: `2001`). | Organiza o IPv6 em partes leg√≠veis. Cada hexteto ser√° convertido em 4 nibbles no reverse DNS. |
| **Hexadecimal** | Sistema num√©rico base 16 (0‚Äì9 / A‚ÄìF). | Representa cada parte do IPv6 de forma compacta; cada d√≠gito hex equivale a 1 nibble. |
| **Nibble** | Unidade de 4 bits (metade de 1 byte). | No DNS reverso IPv6, cada nibble vira uma entrada individual do dom√≠nio `.ip6.arpa`. |
| **Unpacking** | Processo de expandir o IPv6 (ex: `2001:db8::1`) para forma completa. | Necess√°rio para converter todos os d√≠gitos hexadecimais e gerar corretamente a zona reversa IPv6. |
| **Reverse IPv6** | Nome da zona reversa `ip6.arpa`. | Usado para mapear um IPv6 completo at√© o hostname, invertendo nibble por nibble.|
| **ip6.arpa** | Dom√≠nio especial reservado para reverso IPv6. | Recebe a representa√ß√£o invertida em nibbles do IPv6 completo; utilizado por servidores DNS Recursivos. |
| **PTR Record** | Registro que mapeia os nibbles invertidos para um hostname. | Permite resolu√ß√£o reversa IPv6 ‚Äî ex: qual hostname pertence ao IPv6 consultado. |

```bash
#convertendo a Subrede IPv6 de Hexteto para Nibble utilizando o comando IPv6Calc no Ubuntu Server
#op√ß√£o do comando ipv6calc: --quiet (be more quiet), --out (specify output type) revnibbles.arpa
#(convert IPv6 Address to nibble)
sudo ipv6calc --quiet --out revnibbles.arpa 2804:14c:90:8697::/64

#convertendo o Endere√ßo IPv6 de Hexteto para Nibble utilizando o comando IPv6Calc no Ubuntu Server
#op√ß√£o do comando ipv6calc: --quiet (be more quiet), --out (specify output type) revnibbles.arpa
#(convert IPv6 Address to nibble)
sudo ipv6calc -q --out revnibbles.arpa 2804:14c:90:8697::20

#criando a Zona de Pesquisa Reversa IPv6 ip6.arpa Interna no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: create-zone (Create an empty zone named ZONE), *.ip6.arpa (Zone named), 
#ns1.pti.intra (Create register record NS1 with Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil create-zone 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa ns1.pti.intra

#listando todas as Zonas Internas do PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: list-all-zones (List all zones named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil list-all-zones

#listando apenas a Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone list (List same zone named) *.ip6.arpa (Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone list 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa

#verificando erros na Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: check-zone (Check zone ZONE for correctness)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil check-zone 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa

#habilitando o suporte ao DNSSEC na Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: secure-zone (Configures a zone called ZONE with reasonable DNSSEC settings)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil secure-zone 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa

#visualizando detalhes da Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone show (Shows various details of the zone called ZONE)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone show 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa

#removendo o registro do tipo SOA (start of authority) da Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: delete-rrset (Delete named RRSET from zone. NAME must be absolute), *.ip6.arpa (Zone named),
#*.ip6.arpa (record name), SOA (Type of register - start of authority)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil delete-rrset 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa SOA

#criando o registro do tipo SOA (start of authority) da Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), *.ip6.arpa (zone name), *.ip6.arpa (record name), SOA (Type SOA - Start os Authority), 3600 (TTL - Time to Live),
#ns1.pti.intra (NS - primary DNS server), hostmaster.pti.intra. (responsible mail), 2025100801 (number of serial zone),
# 3600 (TTL - time to live zone), 600 (retry zone), 604800 (expire zone), 86400 (minimum negative TTIL)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa SOA 3600 "ns1.pti.intra. hostmaster.pti.intra. 2025100801 3600 600 604800 86400"

#criando o registro do tipo PTR (IPv6 Address) da Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: add-record (Add one or more records of NAME and TYPE to ZONE with CONTENT and optional
#TTL.), *.ip6.arpa (zone name),*.ip6.arpa (register IPv6), PTR (point register), 3600 (TTL - Time to Live)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil add-record 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa 0.2.0.0.0.0.0.0.0.0.0.0.0.0.0.0.7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa PTR 3600 pti.intra
sudo pdnsutil add-record 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa 0.2.0.0.0.0.0.0.0.0.0.0.0.0.0.0.7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa PTR 3600 ns1.pti.intra
sudo pdnsutil add-record 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa 0.2.0.0.0.0.0.0.0.0.0.0.0.0.0.0.7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa PTR 3600 wsvaamonde.pti.intra

#atualizando os registros das Zonas Internas criadas no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: rectify-all-zone
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil rectify-all-zones

#recarregar todas as Zonas Internas do PowerDNS Authoritative sem reiniciar o servi√ßo
#op√ß√£o do comando pdns_control: reload (Instruct the server to reload all its zones, this will not add new zones)
#mais informa√ß√µes acesse: https://doc.powerdns.com/authoritative/manpages/pdns_control.1.html
sudo pdns_control reload

#listando todas as Zonas Internas do PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: list-all-zones (List all zones named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil list-all-zones

#listando apenas a Zona Reversa IPv6 ip6.arpa Interna criada no PowerDNS Authoritative
#op√ß√µes do comando pdnsutil: zone list (List same zone named) pti.intra (Zone named)
#mais informa√ß√µes acesse: https://manpages.debian.org/testing/pdns-server/pdnsutil.1.en.html
sudo pdnsutil zone list 7.9.6.8.0.9.0.0.c.4.1.0.4.0.8.2.ip6.arpa
```

## 21_ Testando as resolu√ß√µes de Zonas e Nomes DNS no PowerDNS Authoritative no Ubuntu Server
```bash
#testando a resolu√ß√£o direta do PowerDNS Recursor com encaminhamento para o PowerDNS Authoritative
sudo nslookup pti.intra

#testando a resolu√ß√£o de nomes do Tipo SOA do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=SOA pti.intra

#testando a resolu√ß√£o de nomes do Tipo NS do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=NS pti.intra

#testando a resolu√ß√£o de nomes do Tipo A (IPv4) do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=A pti.intra

#testando a resolu√ß√£o de nomes do Tipo AAAA (IPv6) do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=AAAA pti.intra

#testando a resolu√ß√£o de nomes do Tipo A (IPv4) do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=A wsvaamonde.pti.intra

#testando a resolu√ß√£o de nomes do Tipo AAAA (IPv6) do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=AAAA wsvaamonde.pti.intra

#testando a resolu√ß√£o de nomes do Tipo A (IPv4) do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=A ns1.pti.intra

#testando a resolu√ß√£o de nomes do Tipo AAAA (IPv6) do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=AAAA ns1.pti.intra

#testando a resolu√ß√£o de nomes do Tipo CNAME do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=CNAME pdns.pti.intra

#testando a resolu√ß√£o reversa do PowerDNS Recursor com encaminhamento para o PowerDNS Authoritative
sudo nslookup 172.16.1.20
sudo nslookup 2804:14c:90:8697::20

#testando a resolu√ß√£o reversa do Tipo PTR do PowerDNS Authoritative
#op√ß√£o do comando nslookup: -type (query type filter)
sudo nslookup -type=PTR 172.16.1.20
sudo nslookup -type=PTR 2804:14c:90:8697::20

#testando o resolu√ß√£o da Zona Interna criada no PowerDNS Authoritative
#op√ß√£o do comando dig: @127.0.0.1 (loopback), -p (port), pti.intra (Zona Interna), A (Register Type IPv4),
# AAAA (Register Type IPv6), +noall (This option sets or clears all display flags), +answer (This option 
#displays [or does not display] the answer section of a reply)
sudo dig @127.0.0.1 -p 5300 pti.intra A +noall +answer
sudo dig @127.0.0.1 -p 5300 pti.intra AAAA +noall +answer

#testando a resolu√ß√£o de Nomes da Zona Interna criada no PowerDNS Authoritative
#op√ß√£o do comando dig: @127.0.0.1 (loopback), -p (port), pti.intra (Zona Interna), A (Register Type IPv4),
# AAAA (Register Type IPv6), +noall (This option sets or clears all display flags), +answer (This option 
#displays [or does not display] the answer section of a reply)
sudo dig @127.0.0.1 -p 5300 wsvaamonde.pti.intra A +noall +answer
sudo dig @127.0.0.1 -p 5300 wsvaamonde.pti.intra AAAA +noall +answer

#testando a resolu√ß√£o de Nomes da Zona Interna criada no PowerDNS Authoritative
#op√ß√£o do comando dig: @127.0.0.1 (loopback), -p (port), pti.intra (Zona Interna), A (Register Type IPv4),
# AAAA (Register Type IPv6), +noall (This option sets or clears all display flags), +answer (This option 
#displays [or does not display] the answer section of a reply)
sudo dig @127.0.0.1 -p 5300 -x 172.16.1.20 +noall +answer
sudo dig @127.0.0.1 -p 5300 -x 2804:14c:90:8697::20 +noall +answer

#testando a resolu√ß√£o de nomes externos do PowerDNS Recursor
sudo nslookup google.com

#analisando os Logs de Pesquisa de Resolu√ß√£o de Nomes do PowerDNS Recursor
#op√ß√£o do comando tcpdump: -n (Don't convert addresses), -i (interface), any (all interface), port (port list)
sudo tcpdump -ni any port 53
```

## 22_ Fazendo o download do PowerDNS Admin e descompactando no diret√≥rio padr√£o do NGINX Server no Ubuntu Server

**OBSERVA√á√ÉO IMPORTANTE:** o aplicativo e os arquivos de configura√ß√£o do *PowerDNS Admin* sofre altera√ß√£o o tempo todo, sempre acessar o projeto do Github para verificar a √∫ltima vers√£o do software no Link: https://github.com/PowerDNS-Admin/PowerDNS-Admin/releases

```bash
#acessando o diret√≥rio tempor√°rio do Ubuntu Server
cd /tmp

#fazendo o download do PowerDNS Admin do site Oficial do Github (Link atualizado em: 20/11/2025)
#op√ß√£o do comando wget: -O (output-document)
wget -O pdns-admin.tar.gz https://github.com/PowerDNS-Admin/PowerDNS-Admin/archive/refs/tags/v0.4.2.tar.gz

#descompactando o arquivo do PowerDNS Admin
#op√ß√£o do comando tar: -z (gzip), -x (extract), -v (verbose), -f (file)
tar -zxvf pdns-admin.tar.gz

#OBSERVA√á√ÉO IMPORTANTE: ALTERAR O CAMINHO DO DESTINO CONFORME NECESSIDADE
#movendo o conte√∫do do PowerDNS Admin para o diret√≥rio de site padr√£o do NGINX Server
#op√ß√£o do comando mv: -v (verbose)
#op√ß√£o do caractere curinga * (asterisco): Qualquer coisa
sudo mv -v PowerDNS-Admin*/ /var/www/html/pdns/
```

## 23_ Atualizando os arquivos de configura√ß√£o do PowerDNS Admin no Ubuntu Server
```bash
#atualizando o arquivo de configura√ß√£o do PowerDNS Admin
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /var/www/html/pdns/powerdnsadmin/default_config.py https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/default_config.py

#atualizando o arquivo de configura√ß√£o do PowerDNS Admin do NGINX Server
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/nginx/conf.d/pdns-admin.conf https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/pdns-admin.conf

#atualizando o arquivo de inicializa√ß√£o do servi√ßo do PowerDNS Admin
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/systemd/system/pdnsadmin.service https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/pdnsadmin.service

#atualizando o arquivo de socket do servi√ßo do PowerDNS Admin
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo wget -v -O /etc/systemd/system/pdnsadmin.socket https://raw.githubusercontent.com/vaamonde/ubuntu-2204/main/conf/pdnsadmin.socket

#criando o diret√≥rio e arquivo de runtime do PowerDNS Admin
#op√ß√£o do comando mkdir: -v (verbose)
#op√ß√£o do comando chown: -R (recursive), -v (verbose), pdns: (user and group)
#op√ß√£o do redirecionador de sa√≠da > (maior): Redireciona a sa√≠da padr√£o (STDOUT)
sudo mkdir -v /run/pdnsadmin/
sudo chown -Rv pdns: /run/pdnsadmin/
echo "d /run/pdnsadmin 0755 pdns pdns -" | sudo tee /etc/tmpfiles.d/pdnsadmin.conf > /dev/null
```

## 24_ Editando os arquivos de configura√ß√£o do PowerDNS Admin no Ubuntu Server
```bash
#editando o arquivo de configura√ß√£o do PowerDNS Admin
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo vim /var/www/html/pdns/powerdnsadmin/default_config.py

#entrando no modo de edi√ß√£o do editor de texto VIM
INSERT
```
```bash
#alterar as linhas de: 21 at√© 22 das vari√°veis dos endere√ßos IPv4 e Porta
BIND_ADDRESS = '172.16.1.20'
PORT = 9191

#alterar as linhas de: 25 at√© 26 das vari√°veis de salt e secret
SALT = 'pwerdns'
SECRET_KEY = 'powerdns'

#alterar as linhas de: 45 at√© 49 das vari√°veis de conex√£o do PostgreSQL Server
SQLA_DB_DRIVER = 'postgresql'
SQLA_DB_USER = 'powerdns'
SQLA_DB_PASSWORD = 'powerdns'
SQLA_DB_HOST = 'powerdns'
SQLA_DB_NAME = 'powerdns
```
```bash
#salvar e sair do arquivo
ESC SHIFT :x <Enter>

#editando o arquivo de configura√ß√£o do PowerDNS Admin do NGINX Server
#op√ß√£o do comando wget: -v (verbose), -O (output file)
sudo vim  /etc/nginx/conf.d/pdns-admin.conf

#entrando no modo de edi√ß√£o do editor de texto VIM
INSERT
```
```bash
#alterar a linha 22 da vari√°vel do nome do servidor do NGINX Server
server_name pdns.pti.intra;
```
```bash
#salvar e sair do arquivo
ESC SHIFT :x <Enter>
```

## 25_ Configurando o Ambiente Virtual e instalando as Depend√™ncias do PowerDNS Admin no Ubuntu Server
```bash
#Acessando o diret√≥rio de instala√ß√£o do PowerDNS-Admin no servidor NGINX
cd /var/www/html/pdns/

#Criando um ambiente virtual isolado em Python 3 para o PowerDNS-Admin
#op√ß√£o do comando virtualenv: -p (virtual python isolation)
virtualenv -p python3 flask

#Ativando o ambiente virtual Python (modo ativo)
source ./flask/bin/activate

#Atualizando o gerenciador de pacotes pip dentro do ambiente virtual
#op√ß√£o do comando python: -m (module), pip install (install module), --upgrade (upgrade module)
python -m pip install --upgrade pip

#Instalando todas as depend√™ncias Python listadas no arquivo requirements.txt
#op√ß√£o do comando pip: install (install module), -r (requirement)
pip install -r requirements.txt

#Definindo a vari√°vel de ambiente FLASK_APP apontando para o aplicativo principal do PowerDNS-Admin
export FLASK_APP=powerdnsadmin/__init__.py

#Atualizando o banco de dados interno do Flask (migra√ß√µes com o Alembic)
#op√ß√£o do comando falsk: db
flask db upgrade

#Instalando as depend√™ncias de frontend (JavaScript/CSS) usando o Yarn
#op√ß√£o do comando yarn: install (), --pure-lockfile
yarn install --pure-lockfile

#Gerando (compilando) os arquivos est√°ticos do frontend do Flask
#op√ß√£o do comando flask: assets
flask assets build

#Desativando o ambiente virtual Python (voltando ao shell normal)
deactivate
```

## 26_ Alterando as permiss√µes dos diret√≥rios do PowerDNS Admin no Ubuntu Server
```bash
#alterando as permiss√µes do diret√≥rio de instala√ß√£o do PowerDNS Admin no NGINX Server
#op√ß√µes do comando chown: -R (recursive), -v (verbose), www-data:www-data (user/owner and group default)
sudo chown -Rv www-data:www-data /var/www/html/pdns

#alterando as permiss√µes do diret√≥rio de administra√ß√£o do PowerDNS Admin no NGINX Server
#op√ß√µes do comando chown: -R (recursive), -v (verbose), pdns: (user/owner default)
sudo chown -Rv pdns: /var/www/html/pdns/powerdnsadmin/
```

## 27_ Desativando o site padr√£o do NGINX Server no Ubuntu Server
```bash
#removendo o arquivo de configura√ß√£o do site padr√£o do NGINX Server
#op√ß√£o do comando rm: -v (verbose)
sudo rm -v /etc/nginx/sites-enabled/default

#testando os arquivos de configura√ß√£o do NGINX Server
#op√ß√£o do comando nginx: -t (test config files)
sudo nginx -t

#reiniciando o servi√ßo do NGINX Server no Ubuntu Server
#op√ß√£o do comando systemctl: restart (Stop and then start one or more units), status (runtime status 
#information)
sudo systemctl restart nginx
sudo systemctl status nginx

#verificando a porta padr√£o TCP-80 do NGINX Server
#op√ß√£o do comando lsof: -n (network number), -P (port number), -i (list IP Address), -s (alone directs)
sudo lsof -nP -iTCP:'80' -sTCP:LISTEN
```

## 28_ Habilitando e iniciando os servi√ßos do PowerDNS Admin no Ubuntu Server
```bash
#habilitando o servi√ßo do PowerDNS Admin no Ubuntu Server
#op√ß√£o do comando systemctl: daemon-reload (Reload the systemd manager configuration), enable (Enable 
#one or more units), --now (When used with enable, the units will also be started), start (Start (activate)
#one or more units), status (runtime status information)
sudo systemctl daemon-reload
sudo systemctl enable --now pdnsadmin.service pdnsadmin.socket
sudo systemctl start pdnsadmin.service pdnsadmin.socket
sudo systemctl status pdnsadmin.service pdnsadmin.socket

#analisando os Log's e mensagens de erros do PowerDNS Admin e Socket
#op√ß√£o do comando journalctl: x (catalog), e (pager-end), u (unit)
sudo journalctl -xeu pdnsadmin
sudo journalctl -xeu pdnsadmin.socket
```

## 29_ Acessando e configurando o PowerDNS Authoritative via navegador no PowerDNS Admin
```bash
#utilizar os navegadores para testar o acesso ao PowerDNS Admin
firefox ou google chrome: http://endere√ßo_ipv4_ubuntuserver
```
```bash
#registrando uma conta de acesso ao PowerDNS Admin
Create an account
  Enter your personal details below
    First name: Seu Nome
    Last name: Seu Sobrenome
    Email: seu_email@seu_dom√≠nio.intra
    Username: SEU_USU√ÅRIO
    Password: SUA_SENHA_SEGURA
    Retype password: CONFIRMAR_SUA_sENHA
    Captcha: 123456
  <Register>
```
```bash
#se autenticando com a conta criada no PowerDNS Admin
PowerDNS-Admin
  Username: SEU_USU√ÅRIO
  Password: SUA_SENHA
  OPT Token: Default (s√£o configura√ß√£o)
  Remember Me: (ON)
<Sign In>
```
```bash
#configura√ß√£o do PowerDNS Authoritative no PowerDNS Admin
Server Settings
  PowerDNS API URL: http://127.0.0.1:8081/
  PowerDNS API Key: powerdns
  PowerDNS Version: 5.0.0
<Save Settings>
```
```bash
#habilitando a visualiza√ß√£o dos registros das zonas no PowerDNS Admin
Administration
  Settings
    Zone Records
       1  A      Forward Zone: (Yes)  Reverse Zone: (Yes)
       2  AAAA   Forward Zone: (Yes)  Reverse Zone: (Yes)
       9  CNAME  Forward Zone: (Yes)  Reverse Zone: (Yes)
      17  MX     Forward Zone: (Yes)  Reverse Zone: (Yes)
      27  SOA    Forward Zone: (Yes)  Reverse Zone: (Yes)
  <Save Settings>
```
```bash
#criando uma conta de gerenciamento das Zonas do PowerDNS Admin
Administration
  Accounts
    <+Add Account>
      Create Account
        Account Editor
          Name: hostmaster
          Description: Descri√ß√£o da Conta
          Contact Person: Telefone de Contato da Conta
          Mail Address: hostmaster@seu_dom√≠nio.intra
        Access Control
          Click on users to move between columns: seu_usu√°rio
          Click on zones to move between columns: seu_dom√≠nio
    <Create Account>
```
```bash
#habilitando a atualiza√ß√£o da Zona de Pesquisa Inversa no PowerDNS Admin
Zone Management
  Dashboard
    Zones
      Clique em: sua_zona
        <Zone Settings>
          Change Zone Account
            Account: hostmaster <Update Account>
          Zone Access Control
            Click on users to move from between columns: seu_usu√°rio
          <Save Changes>
          Auto PTR creation
            Allow automatic reverse pointer creation on record updates? (ON)
              New setting created and updated. <Close>
```
```bash
#habilitando a atualiza√ß√£o da Zona de Pesquisa Reversa IPv4 no PowerDNS Admin
Zone Management
  Dashboard
    Zones in-addr.arpa
      Clique em: sua_zona_reversa
        <Zone Settings>
          Change Zone Account
            Account: hostmaster <Update Account>
          Zone Access Control
            Click on users to move from between columns: seu_usu√°rio
          <Save Changes>
          Auto PTR creation
            Allow automatic reverse pointer creation on record updates? (ON)
              New setting created and updated. <Close>
```
```bash
#habilitando a atualiza√ß√£o da Zona de Pesquisa Reversa IPv6 no PowerDNS Admin
Zone Management
  Dashboard
    Zones ip6.arpa
      Clique em: sua_zona_reversa
        <Zone Settings>
          Change Zone Account
            Account: hostmaster <Update Account>
          Zone Access Control
            Click on users to move from between columns: seu_usu√°rio
          <Save Changes>
          Auto PTR creation
            Allow automatic reverse pointer creation on record updates? (ON)
              New setting created and updated. <Close>
```

========================================DESAFIOS=========================================

**#30_ DESAFIO-01:** 

=========================================================================================

**OBSERVA√á√ÉO IMPORTANTE:** COMENTAR NO V√çDEO DO POWERDNS SE VOC√ä CONSEGUIU FAZER O DESAFIO COM A SEGUINTE FRASE: *Desafio do PowerDNS realizado com sucesso!!! #BoraParaPr√°tica*

COMPARTILHAR O SELO DO DESAFIO NAS SUAS REDES SOCIAIS (LINKEDIN, FACEBOOK, INSTAGRAM) MARCANDO: ROBSON VAAMONDE COM AS HASHTAGS E COPIANDO O CONTE√öDO DO DESAFIO ABAIXO: 

LINK DO SELO: https://github.com/vaamonde/ubuntu-2204/blob/main/selos/23-powerdns.png

#boraparapratica #boraparapr√°tica #vaamonde #robsonvaamonde #procedimentosemti #ubuntuserver #ubuntuserver2204 #desafiovaamonde #desafioboraparapratica #desafiopowerdns #desafiopowerdnsadmin

